import{N as u}from"./vendor-YNJc-BV066b5N.js";import{g as C}from"./vendor-RODT-CrxIlgye.js";import{h as N,j as y}from"./vendor-7avT-DhdrFwTb.js";import{d as p}from"./vendor-UUu6-BeUS1t8s.js";import{t as g}from"./vendor-RE7Z-DOm9JKld.js";class D{constructor(e){this.currentNode=null,this.currentNodeKey=null;for(const t in e)N(e,t)&&(this[t]=e[t]);this.nodesMap={}}initialize(){if(this.root=new u({data:this.data,store:this}),this.root.initialize(),this.lazy&&this.load){const e=this.load;e(this.root,t=>{this.root.doCreateChildren(t),this._initDefaultCheckedNodes()})}else this._initDefaultCheckedNodes()}filter(e){const t=this.filterNodeMethod,s=this.lazy,o=async function(i){const c=i.root?i.root.childNodes:i.childNodes;for(const[r,d]of c.entries())d.visible=t.call(d,e,d.data,d),r%80===0&&r>0&&await g(),o(d);if(!i.visible&&c.length){let r=!0;r=!c.some(d=>d.visible),i.root?i.root.visible=r===!1:i.visible=r===!1}e&&i.visible&&!i.isLeaf&&(!s||i.loaded)&&i.expand()};o(this)}setData(e){e!==this.root.data?(this.nodesMap={},this.root.setData(e),this._initDefaultCheckedNodes(),this.setCurrentNodeKey(this.currentNodeKey)):this.root.updateChildren()}getNode(e){if(e instanceof u)return e;const t=y(e)?C(this.key,e):e;return this.nodesMap[t]||null}insertBefore(e,t){const s=this.getNode(t);s.parent.insertBefore({data:e},s)}insertAfter(e,t){const s=this.getNode(t);s.parent.insertAfter({data:e},s)}remove(e){const t=this.getNode(e);t&&t.parent&&(t===this.currentNode&&(this.currentNode=null),t.parent.removeChild(t))}append(e,t){const s=p(t)?this.root:this.getNode(t);s&&s.insertChild({data:e})}_initDefaultCheckedNodes(){const e=this.defaultCheckedKeys||[],t=this.nodesMap;e.forEach(s=>{const o=t[s];o&&o.setChecked(!0,!this.checkStrictly)})}_initDefaultCheckedNode(e){(this.defaultCheckedKeys||[]).includes(e.key)&&e.setChecked(!0,!this.checkStrictly)}setDefaultCheckedKey(e){e!==this.defaultCheckedKeys&&(this.defaultCheckedKeys=e,this._initDefaultCheckedNodes())}registerNode(e){const t=this.key;!e||!e.data||(t?e.key!==void 0&&(this.nodesMap[e.key]=e):this.nodesMap[e.id]=e)}deregisterNode(e){!this.key||!e||!e.data||(e.childNodes.forEach(s=>{this.deregisterNode(s)}),delete this.nodesMap[e.key])}getCheckedNodes(e=!1,t=!1){const s=[],o=function(i){(i.root?i.root.childNodes:i.childNodes).forEach(r=>{(r.checked||t&&r.indeterminate)&&(!e||e&&r.isLeaf)&&s.push(r.data),o(r)})};return o(this),s}getCheckedKeys(e=!1){return this.getCheckedNodes(e).map(t=>(t||{})[this.key])}getHalfCheckedNodes(){const e=[],t=function(s){(s.root?s.root.childNodes:s.childNodes).forEach(i=>{i.indeterminate&&e.push(i.data),t(i)})};return t(this),e}getHalfCheckedKeys(){return this.getHalfCheckedNodes().map(e=>(e||{})[this.key])}_getAllNodes(){const e=[],t=this.nodesMap;for(const s in t)N(t,s)&&e.push(t[s]);return e}updateChildren(e,t){const s=this.nodesMap[e];if(!s)return;const o=s.childNodes;for(let i=o.length-1;i>=0;i--){const c=o[i];this.remove(c.data)}for(let i=0,c=t.length;i<c;i++){const r=t[i];this.append(r,s.data)}}_setCheckedKeys(e,t=!1,s){const o=this._getAllNodes().sort((d,n)=>d.level-n.level),i=Object.create(null),c=Object.keys(s);o.forEach(d=>d.setChecked(!1,!1));const r=d=>{d.childNodes.forEach(n=>{var h;i[n.data[e]]=!0,(h=n.childNodes)!=null&&h.length&&r(n)})};for(let d=0,n=o.length;d<n;d++){const h=o[d],l=h.data[e].toString();if(!c.includes(l)){h.checked&&!i[l]&&h.setChecked(!1,!1);continue}if(h.childNodes.length&&r(h),h.isLeaf||this.checkStrictly){h.setChecked(!0,!1);continue}if(h.setChecked(!0,!0),t){h.setChecked(!1,!1);const f=function(k){k.childNodes.forEach(a=>{a.isLeaf||a.setChecked(!1,!1),f(a)})};f(h)}}}setCheckedNodes(e,t=!1){const s=this.key,o={};e.forEach(i=>{o[(i||{})[s]]=!0}),this._setCheckedKeys(s,t,o)}setCheckedKeys(e,t=!1){this.defaultCheckedKeys=e;const s=this.key,o={};e.forEach(i=>{o[i]=!0}),this._setCheckedKeys(s,t,o)}setDefaultExpandedKeys(e){e=e||[],this.defaultExpandedKeys=e,e.forEach(t=>{const s=this.getNode(t);s&&s.expand(null,this.autoExpandParent)})}setChecked(e,t,s){const o=this.getNode(e);o&&o.setChecked(!!t,s)}getCurrentNode(){return this.currentNode}setCurrentNode(e){const t=this.currentNode;t&&(t.isCurrent=!1),this.currentNode=e,this.currentNode.isCurrent=!0}setUserCurrentNode(e,t=!0){const s=e[this.key],o=this.nodesMap[s];this.setCurrentNode(o),t&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0)}setCurrentNodeKey(e,t=!0){if(this.currentNodeKey=e,e==null){this.currentNode&&(this.currentNode.isCurrent=!1),this.currentNode=null;return}const s=this.getNode(e);s&&(this.setCurrentNode(s),t&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0))}}export{D as T};
