import{T as _e,w as ke,b as he}from"./vendor-8F4M-BzORa8vA.js";import{a as L}from"./vendor-5WKb-KWd2YoVw.js";import{E as we}from"./vendor-dKFv-DtdAHhrL.js";import{E as be}from"./vendor-dRvv-yZJBuJTF.js";import{E as _}from"./vendor-AQSj-DFJim-ok.js";import{s as Ie,f as Ce,e as xe,a as Ee,b as ze,z as Ne,g as Te,r as Le,h as Oe}from"./vendor-Fq1d-qefZ2EtI.js";import{i as Re,a as ye}from"./vendor-nI5c-1mWdIORn.js";import{_ as $e}from"./vendor-pM4a-CqGSI99y.js";import{u as Se}from"./vendor-cebD-BGFhTQCu.js";import{u as Me}from"./vendor-unoq-CFxLHdLI.js";import{u as Ve}from"./vendor-Av2w-53qXiP8M.js";import{E as w}from"./vendor-bP7i-BUADUvnR.js";import{k as Ae}from"./vendor-X8P5-CF3LkWx9.js";import{t as A}from"./vendor-Y0Io-CY82OFkb.js";import{d as Q,c as k,w as W,t as De,e as Xe,f as Z,o as b,h as f,z as l,b as v,C as I,a as O,r as D,F as j,E as Ye,i as Fe,D as Pe,y as Be}from"./vendor-RE7Z-DOm9JKld.js";import{m as G,r as C,e as He,s as qe,u as a}from"./vendor-eqDO-Ti6p_k8X.js";import{a as J,n as i,t as Ke}from"./vendor-7avT-DhdrFwTb.js";const We=Q({name:"ElImageViewer"}),Ze=Q({...We,props:ye,emits:Re,setup(U,{expose:ee,emit:z}){var X;const r=U,x={CONTAIN:{name:"contain",icon:G(Ce)},ORIGINAL:{name:"original",icon:G(Ie)}},{t:ae}=Se(),s=Me("image-viewer"),{nextZIndex:te}=Ve(),R=C(),Y=C([]),F=He(),h=C(!0),c=C(r.initialIndex),N=qe(x.CONTAIN),o=C({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),se=C((X=r.zIndex)!=null?X:te()),oe=k(()=>{const{urlList:e}=r;return e.length<=1}),P=k(()=>c.value===0),B=k(()=>c.value===r.urlList.length-1),ne=k(()=>r.urlList[c.value]),le=k(()=>[s.e("btn"),s.e("prev"),s.is("disabled",!r.infinite&&P.value)]),re=k(()=>[s.e("btn"),s.e("next"),s.is("disabled",!r.infinite&&B.value)]),ie=k(()=>{const{scale:e,deg:n,offsetX:t,offsetY:u,enableTransition:d}=o.value;let m=t/e,g=u/e;const E=n*Math.PI/180,q=Math.cos(E),K=Math.sin(E);m=m*q+g*K,g=g*q-t/e*K;const V={transform:`scale(${e}) rotate(${n}deg) translate(${m}px, ${g}px)`,transition:d?"transform .3s":""};return N.value.name===x.CONTAIN.name&&(V.maxWidth=V.maxHeight="100%"),V}),ce=k(()=>`${c.value+1} / ${r.urlList.length}`);function T(){fe(),z("close")}function ue(){const e=A(t=>{switch(t.code){case w.esc:r.closeOnPressEscape&&T();break;case w.space:y();break;case w.left:S();break;case w.up:p("zoomIn");break;case w.right:M();break;case w.down:p("zoomOut");break}}),n=A(t=>{const u=t.deltaY||t.deltaX;p(u<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});F.run(()=>{L(document,"keydown",e),L(document,"wheel",n)})}function fe(){F.stop()}function de(){h.value=!1}function me(e){h.value=!1,e.target.alt=ae("el.image.error")}function ve(e){if(h.value||e.button!==0||!R.value)return;o.value.enableTransition=!1;const{offsetX:n,offsetY:t}=o.value,u=e.pageX,d=e.pageY,m=A(E=>{o.value={...o.value,offsetX:n+E.pageX-u,offsetY:t+E.pageY-d}}),g=L(document,"mousemove",m);L(document,"mouseup",()=>{g()}),e.preventDefault()}function H(){o.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function y(){if(h.value)return;const e=Ae(x),n=Object.values(x),t=N.value.name,d=(n.findIndex(m=>m.name===t)+1)%e.length;N.value=x[e[d]],H()}function $(e){const n=r.urlList.length;c.value=(e+n)%n}function S(){P.value&&!r.infinite||$(c.value-1)}function M(){B.value&&!r.infinite||$(c.value+1)}function p(e,n={}){if(h.value)return;const{minScale:t,maxScale:u}=r,{zoomRate:d,rotateDeg:m,enableTransition:g}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...n};switch(e){case"zoomOut":o.value.scale>t&&(o.value.scale=Number.parseFloat((o.value.scale/d).toFixed(3)));break;case"zoomIn":o.value.scale<u&&(o.value.scale=Number.parseFloat((o.value.scale*d).toFixed(3)));break;case"clockwise":o.value.deg+=m,z("rotate",o.value.deg);break;case"anticlockwise":o.value.deg-=m,z("rotate",o.value.deg);break}o.value.enableTransition=g}function pe(e){var n;((n=e.detail)==null?void 0:n.focusReason)==="pointer"&&e.preventDefault()}function ge(){r.closeOnPressEscape&&T()}return W(ne,()=>{De(()=>{const e=Y.value[0];e!=null&&e.complete||(h.value=!0)})}),W(c,e=>{H(),z("switch",e)}),Xe(()=>{ue()}),ee({setActiveItem:$}),(e,n)=>(b(),Z(a(be),{to:"body",disabled:!e.teleported},{default:f(()=>[l(_e,{name:"viewer-fade",appear:""},{default:f(()=>[v("div",{ref_key:"wrapper",ref:R,tabindex:-1,class:i(a(s).e("wrapper")),style:J({zIndex:se.value})},[l(a(we),{loop:"",trapped:"","focus-trap-el":R.value,"focus-start-el":"container",onFocusoutPrevented:pe,onReleaseRequested:ge},{default:f(()=>[v("div",{class:i(a(s).e("mask")),onClick:ke(t=>e.hideOnClickModal&&T(),["self"])},null,10,["onClick"]),I(" CLOSE "),v("span",{class:i([a(s).e("btn"),a(s).e("close")]),onClick:T},[l(a(_),null,{default:f(()=>[l(a(xe))]),_:1})],2),I(" ARROW "),a(oe)?I("v-if",!0):(b(),O(j,{key:0},[v("span",{class:i(a(le)),onClick:S},[l(a(_),null,{default:f(()=>[l(a(Ee))]),_:1})],2),v("span",{class:i(a(re)),onClick:M},[l(a(_),null,{default:f(()=>[l(a(ze))]),_:1})],2)],64)),e.showProgress?(b(),O("div",{key:1,class:i([a(s).e("btn"),a(s).e("progress")])},[D(e.$slots,"progress",{activeIndex:c.value,total:e.urlList.length},()=>[Ye(Ke(a(ce)),1)])],2)):I("v-if",!0),I(" ACTIONS "),v("div",{class:i([a(s).e("btn"),a(s).e("actions")])},[v("div",{class:i(a(s).e("actions__inner"))},[D(e.$slots,"toolbar",{actions:p,prev:S,next:M,reset:y,activeIndex:c.value},()=>[l(a(_),{onClick:t=>p("zoomOut")},{default:f(()=>[l(a(Ne))]),_:1},8,["onClick"]),l(a(_),{onClick:t=>p("zoomIn")},{default:f(()=>[l(a(Te))]),_:1},8,["onClick"]),v("i",{class:i(a(s).e("actions__divider"))},null,2),l(a(_),{onClick:y},{default:f(()=>[(b(),Z(Fe(a(N).icon)))]),_:1}),v("i",{class:i(a(s).e("actions__divider"))},null,2),l(a(_),{onClick:t=>p("anticlockwise")},{default:f(()=>[l(a(Le))]),_:1},8,["onClick"]),l(a(_),{onClick:t=>p("clockwise")},{default:f(()=>[l(a(Oe))]),_:1},8,["onClick"])])],2)],2),I(" CANVAS "),v("div",{class:i(a(s).e("canvas"))},[(b(!0),O(j,null,Pe(e.urlList,(t,u)=>Be((b(),O("img",{ref_for:!0,ref:d=>Y.value[u]=d,key:t,src:t,style:J(a(ie)),class:i(a(s).e("img")),crossorigin:e.crossorigin,onLoad:de,onError:me,onMousedown:ve},null,46,["src","crossorigin"])),[[he,u===c.value]])),128))],2),D(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var da=$e(Ze,[["__file","image-viewer.vue"]]);export{da as I};
