import{u as $,t as d,c as m,g as j,f as I,a as V,o as q,i as x}from"./vendor-riPr-DemVfZF7.js";import{O as U,a as w,F as b,b as k,c as C,d as J}from"./vendor-jkgG-C3m71WyD.js";import{_ as M}from"./vendor-pM4a-CqGSI99y.js";import{u as Y}from"./vendor-8cTO-DiYCmpZ9.js";import{E as z}from"./vendor-bP7i-BUADUvnR.js";import{c as G}from"./vendor-7avT-DhdrFwTb.js";import{i as H}from"./vendor-16Vo-CHIgUVhi.js";import{d as Q,r as W,w as g,e as X,j as Z,t as N,p as ee}from"./vendor-RE7Z-DOm9JKld.js";import{r as te,u as T}from"./vendor-eqDO-Ti6p_k8X.js";const ne=Q({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[U,w,"focusin","focusout","focusout-prevented","release-requested"],setup(n,{emit:u}){const s=te();let v,p;const{focusReason:i}=$();Y(e=>{n.trapped&&!f.paused&&u("release-requested",e)});const f={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},l=e=>{if(!n.loop&&!n.trapped||f.paused)return;const{code:t,altKey:o,ctrlKey:a,metaKey:r,currentTarget:h,shiftKey:K}=e,{loop:D}=n,B=t===z.tab&&!o&&!a&&!r,E=document.activeElement;if(B&&E){const P=h,[y,O]=j(P);if(y&&O){if(!K&&E===O){const c=m({focusReason:i.value});u("focusout-prevented",c),c.defaultPrevented||(e.preventDefault(),D&&d(y,!0))}else if(K&&[y,P].includes(E)){const c=m({focusReason:i.value});u("focusout-prevented",c),c.defaultPrevented||(e.preventDefault(),D&&d(O,!0))}}else if(E===P){const c=m({focusReason:i.value});u("focusout-prevented",c),c.defaultPrevented||e.preventDefault()}}};ee(J,{focusTrapRef:s,onKeydown:l}),g(()=>n.focusTrapEl,e=>{e&&(s.value=e)},{immediate:!0}),g([s],([e],[t])=>{e&&(e.addEventListener("keydown",l),e.addEventListener("focusin",F),e.addEventListener("focusout",_)),t&&(t.removeEventListener("keydown",l),t.removeEventListener("focusin",F),t.removeEventListener("focusout",_))});const L=e=>{u(U,e)},S=e=>u(w,e),F=e=>{const t=T(s);if(!t)return;const o=e.target,a=e.relatedTarget,r=o&&t.contains(o);n.trapped||a&&t.contains(a)||(v=a),r&&u("focusin",e),!f.paused&&n.trapped&&(r?p=o:d(p,!0))},_=e=>{const t=T(s);if(!(f.paused||!t))if(n.trapped){const o=e.relatedTarget;!H(o)&&!t.contains(o)&&setTimeout(()=>{if(!f.paused&&n.trapped){const a=m({focusReason:i.value});u("focusout-prevented",a),a.defaultPrevented||d(p,!0)}},0)}else{const o=e.target;o&&t.contains(o)||u("focusout",e)}};async function A(){await N();const e=T(s);if(e){I.push(f);const t=e.contains(document.activeElement)?v:document.activeElement;if(v=t,!e.contains(t)){const a=new Event(b,k);e.addEventListener(b,L),e.dispatchEvent(a),a.defaultPrevented||N(()=>{let r=n.focusStartEl;G(r)||(d(r),document.activeElement!==r&&(r="first")),r==="first"&&V(q(e),!0),(document.activeElement===t||r==="container")&&d(e)})}}}function R(){const e=T(s);if(e){e.removeEventListener(b,L);const t=new CustomEvent(C,{...k,detail:{focusReason:i.value}});e.addEventListener(C,S),e.dispatchEvent(t),!t.defaultPrevented&&(i.value=="keyboard"||!x()||e.contains(document.activeElement))&&d(v??document.body),e.removeEventListener(C,S),I.remove(f)}}return X(()=>{n.trapped&&A(),g(()=>n.trapped,e=>{e?A():R()})}),Z(()=>{n.trapped&&R(),s.value&&(s.value.removeEventListener("keydown",l),s.value.removeEventListener("focusin",F),s.value.removeEventListener("focusout",_),s.value=void 0)}),{onKeydown:l}}});function se(n,u,s,v,p,i){return W(n.$slots,"default",{handleKeydown:n.onKeydown})}var pe=M(ne,[["render",se],["__file","focus-trap.vue"]]);export{pe as E};
