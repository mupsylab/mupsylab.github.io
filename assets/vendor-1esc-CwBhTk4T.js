import{u as I}from"./vendor-unoq-CFxLHdLI.js";import{d as b}from"./vendor-7avT-DhdrFwTb.js";import{r as N,a as E}from"./vendor-7XBs-C2ZIZBcB.js";import{r as P}from"./vendor-eqDO-Ti6p_k8X.js";import{p as k}from"./vendor-RE7Z-DOm9JKld.js";const B=Symbol("dragEvents");function M({props:p,ctx:f,el$:T,dropIndicator$:$,store:g}){const u=I("tree"),d=P({showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0,dropType:null});return k(B,{treeNodeDragStart:({event:n,treeNode:a})=>{if(b(p.allowDrag)&&!p.allowDrag(a.node))return n.preventDefault(),!1;n.dataTransfer.effectAllowed="move";try{n.dataTransfer.setData("text/plain","")}catch{}d.value.draggingNode=a,f.emit("node-drag-start",a.node,n)},treeNodeDragOver:({event:n,treeNode:a})=>{const e=a,o=d.value.dropNode;o&&o.node.id!==e.node.id&&N(o.$el,u.is("drop-inner"));const r=d.value.draggingNode;if(!r||!e)return;let l=!0,t=!0,s=!0,h=!0;b(p.allowDrop)&&(l=p.allowDrop(r.node,e.node,"prev"),h=t=p.allowDrop(r.node,e.node,"inner"),s=p.allowDrop(r.node,e.node,"next")),n.dataTransfer.dropEffect=t||l||s?"move":"none",(l||t||s)&&(o==null?void 0:o.node.id)!==e.node.id&&(o&&f.emit("node-drag-leave",r.node,o.node,n),f.emit("node-drag-enter",r.node,e.node,n)),l||t||s?d.value.dropNode=e:d.value.dropNode=null,e.node.nextSibling===r.node&&(s=!1),e.node.previousSibling===r.node&&(l=!1),e.node.contains(r.node,!1)&&(t=!1),(r.node===e.node||r.node.contains(e.node))&&(l=!1,t=!1,s=!1);const c=e.$el.querySelector(`.${u.be("node","content")}`).getBoundingClientRect(),v=T.value.getBoundingClientRect();let i;const S=l?t?.25:s?.45:1:-1,C=s?t?.75:l?.55:0:1;let m=-9999;const w=n.clientY-c.top;w<c.height*S?i="before":w>c.height*C?i="after":t?i="inner":i="none";const D=e.$el.querySelector(`.${u.be("node","expand-icon")}`).getBoundingClientRect(),y=$.value;i==="before"?m=D.top-v.top:i==="after"&&(m=D.bottom-v.top),y.style.top=`${m}px`,y.style.left=`${D.right-v.left}px`,i==="inner"?E(e.$el,u.is("drop-inner")):N(e.$el,u.is("drop-inner")),d.value.showDropIndicator=i==="before"||i==="after",d.value.allowDrop=d.value.showDropIndicator||h,d.value.dropType=i,f.emit("node-drag-over",r.node,e.node,n)},treeNodeDragEnd:n=>{const{draggingNode:a,dropType:e,dropNode:o}=d.value;if(n.preventDefault(),n.dataTransfer&&(n.dataTransfer.dropEffect="move"),a&&o){const r={data:a.node.data};e!=="none"&&a.node.remove(),e==="before"?o.node.parent.insertBefore(r,o.node):e==="after"?o.node.parent.insertAfter(r,o.node):e==="inner"&&o.node.insertChild(r),e!=="none"&&(g.value.registerNode(r),g.value.key&&a.node.eachNode(l=>{var t;(t=g.value.nodesMap[l.data[g.value.key]])==null||t.setChecked(l.checked,!g.value.checkStrictly)})),N(o.$el,u.is("drop-inner")),f.emit("node-drag-end",a.node,o.node,e,n),e!=="none"&&f.emit("node-drop",a.node,o.node,e,n)}a&&!o&&f.emit("node-drag-end",a.node,null,e,n),d.value.showDropIndicator=!1,d.value.draggingNode=null,d.value.dropNode=null,d.value.allowDrop=!0}}),{dragState:d}}export{B as d,M as u};
