import{u as I}from"./vendor-5WKb-KWd2YoVw.js";import{k as xt}from"./vendor-Fq1d-qefZ2EtI.js";import{u as Ot}from"./vendor-ETvy-BHd1jime.js";import{u as It}from"./vendor-PaCD-BGOM4hNh.js";import{u as pt}from"./vendor-cebD-BGFhTQCu.js";import{u as Ce}from"./vendor-unoq-CFxLHdLI.js";import{u as wt,a as Ct}from"./vendor-eqCW-DCj8_tuZ.js";import{a as yt}from"./vendor-wml0-D8cMrmnG.js";import{u as Tt}from"./vendor-5iTR-BBy9iiW8.js";import{u as Et}from"./vendor-GuIu-Dc0c8fP9.js";import{i as T,j as Y,d as H}from"./vendor-7avT-DhdrFwTb.js";import{V as Mt}from"./vendor-9yxy-Cbwm2u4R.js";import{u as St}from"./vendor-hmuK-B6xHqdWm.js";import{E as Rt}from"./vendor-bP7i-BUADUvnR.js";import{d as Wt}from"./vendor-0rdd-Cq9Fpw4b.js";import{i as _t}from"./vendor-UUu6-BeUS1t8s.js";import{U as Ft,C as Lt}from"./vendor-lLeK-BB_Ol6Sd.js";import{e as Nt}from"./vendor-W2mj-CCBXsyCN.js";import{d as Dt}from"./vendor-9Eji-ZqQOO7NL.js";import{g as B}from"./vendor-sXNC-Da9ghdLI.js";import{i as Z}from"./vendor-ys5x-C1IsWqtu.js";import{f as Ht}from"./vendor-M72u-CqA7X5PQ.js";import{a as Bt,r as d}from"./vendor-eqDO-Ti6p_k8X.js";import{c as i,w as E,t as p,m as ye,e as Pt}from"./vendor-RE7Z-DOm9JKld.js";const dl=(t,h)=>{const{t:M}=pt(),P=Ce("select"),Te=Ce("input"),{form:S,formItem:g}=wt(),{inputId:Ee}=Ct(t,{formItemContext:g}),{aliasProps:ee,getLabel:V,getValue:f,getDisabled:R,getOptions:Me}=It(t),{valueOnClear:Se,isEmptyValue:te}=yt(t),n=Bt({inputValue:"",cachedOptions:[],createdOptions:[],hoveringIndex:-1,inputHovering:!1,selectionWidth:0,collapseItemWidth:0,previousQuery:null,previousValue:void 0,selectedLabel:"",menuVisibleOnFocus:!1,isBeforeHide:!1}),W=d(-1),K=d(),w=d(),_=d(),k=d(),b=d(),Re=d(),We=d(),x=d(),le=d(),F=d(),{isComposing:ne,handleCompositionStart:_e,handleCompositionEnd:Fe,handleCompositionUpdate:Le}=Tt({afterComposition:e=>pe(e)}),{wrapperRef:ae,isFocused:ue,handleBlur:Ne}=Et(b,{beforeFocus(){return O.value},afterFocus(){t.automaticDropdown&&!o.value&&(o.value=!0,n.menuVisibleOnFocus=!0)},beforeBlur(e){var l,a;return((l=_.value)==null?void 0:l.isFocusInsideContent(e))||((a=k.value)==null?void 0:a.isFocusInsideContent(e))},afterBlur(){o.value=!1,n.menuVisibleOnFocus=!1}}),v=d([]),s=d([]),o=d(!1),O=i(()=>t.disabled||(S==null?void 0:S.disabled)),De=i(()=>{var e;return(e=S==null?void 0:S.statusIcon)!=null?e:!1}),He=i(()=>{const e=s.value.length*t.itemHeight;return e>t.height?t.height:e}),L=i(()=>t.multiple?T(t.modelValue)&&t.modelValue.length>0:!te(t.modelValue)),Be=i(()=>t.clearable&&!O.value&&n.inputHovering&&L.value),ie=i(()=>t.remote&&t.filterable?"":xt),Pe=i(()=>ie.value&&P.is("reverse",o.value)),z=i(()=>(g==null?void 0:g.validateState)||""),Ke=i(()=>{if(z.value)return Mt[z.value]}),oe=i(()=>t.remote?300:0),se=i(()=>t.loading?t.loadingText||M("el.select.loading"):t.remote&&!n.inputValue&&v.value.length===0?!1:t.filterable&&n.inputValue&&v.value.length>0&&s.value.length===0?t.noMatchText||M("el.select.noMatch"):v.value.length===0?t.noDataText||M("el.select.noData"):null),ce=e=>{const l=a=>{if(t.filterable&&H(t.filterMethod)||t.filterable&&t.remote&&H(t.remoteMethod))return!0;const u=new RegExp(Nt(e),"i");return e?u.test(V(a)||""):!0};return t.loading?[]:[...n.createdOptions,...t.options].reduce((a,u)=>{const c=Me(u);if(T(c)){const m=c.filter(l);m.length>0&&a.push({label:V(u),type:"Group"},...m)}else(t.remote||l(u))&&a.push(u);return a},[])},re=()=>{v.value=ce(""),s.value=ce(n.inputValue)},de=i(()=>{const e=new Map;return v.value.forEach((l,a)=>{e.set(r(f(l)),{option:l,index:a})}),e}),N=i(()=>{const e=new Map;return s.value.forEach((l,a)=>{e.set(r(f(l)),{option:l,index:a})}),e}),ke=i(()=>s.value.every(e=>R(e))),fe=St(),ze=i(()=>fe.value==="small"?"small":"default"),C=()=>{var e;if(_t(t.fitInputWidth)){W.value=t.fitInputWidth;return}const l=((e=K.value)==null?void 0:e.offsetWidth)||200;!t.fitInputWidth&&v.value.length>0?p(()=>{W.value=Math.max(l,Ae())}):W.value=l},Ae=()=>{var e,l;const u=document.createElement("canvas").getContext("2d"),c=P.be("dropdown","item"),we=(((l=(e=x.value)==null?void 0:e.listRef)==null?void 0:l.innerRef)||document).querySelector(`.${c}`);if(we===null||u===null)return 0;const X=getComputedStyle(we),ht=Number.parseFloat(X.paddingLeft)+Number.parseFloat(X.paddingRight);return u.font=X.font,s.value.reduce((gt,Vt)=>{const bt=u.measureText(V(Vt));return Math.max(bt.width,gt)},0)+ht},Ge=()=>{if(!w.value)return 0;const e=window.getComputedStyle(w.value);return Number.parseFloat(e.gap||"6px")},Qe=i(()=>{const e=Ge();return{maxWidth:`${F.value&&t.maxCollapseTags===1?n.selectionWidth-n.collapseItemWidth-e:n.selectionWidth}px`}}),$e=i(()=>({maxWidth:`${n.selectionWidth}px`})),Ue=i(()=>T(t.modelValue)?t.modelValue.length===0&&!n.inputValue:t.filterable?!n.inputValue:!0),je=i(()=>{var e;const l=(e=t.placeholder)!=null?e:M("el.select.placeholder");return t.multiple||!L.value?l:n.selectedLabel}),qe=i(()=>{var e,l;return(l=(e=_.value)==null?void 0:e.popperRef)==null?void 0:l.contentRef}),Je=i(()=>{if(t.multiple){const e=t.modelValue.length;if(t.modelValue.length>0&&N.value.has(t.modelValue[e-1])){const{index:l}=N.value.get(t.modelValue[e-1]);return l}}else if(!te(t.modelValue)&&N.value.has(t.modelValue)){const{index:e}=N.value.get(t.modelValue);return e}return-1}),Xe=i({get(){return o.value&&se.value!==!1},set(e){o.value=e}}),Ye=i(()=>t.multiple?t.collapseTags?n.cachedOptions.slice(0,t.maxCollapseTags):n.cachedOptions:[]),Ze=i(()=>t.multiple?t.collapseTags?n.cachedOptions.slice(t.maxCollapseTags):[]:[]),{createNewOption:me,removeNewOption:A,selectNewOption:ve,clearAllNewOption:G}=Ot(t,n),Q=()=>{O.value||(n.menuVisibleOnFocus?n.menuVisibleOnFocus=!1:o.value=!o.value)},he=()=>{n.inputValue.length>0&&!o.value&&(o.value=!0),me(n.inputValue),$(n.inputValue)},ge=Dt(he,oe.value),$=e=>{n.previousQuery===e||ne.value||(n.previousQuery=e,t.filterable&&H(t.filterMethod)?t.filterMethod(e):t.filterable&&t.remote&&H(t.remoteMethod)&&t.remoteMethod(e),t.defaultFirstOption&&(t.filterable||t.remote)&&s.value.length?p(et):p(dt))},et=()=>{const e=s.value.filter(u=>!u.disabled&&u.type!=="Group"),l=e.find(u=>u.created),a=e[0];n.hoveringIndex=U(s.value,l||a)},tt=e=>{Z(t.modelValue,e)||h(Lt,e)},y=e=>{h(Ft,e),tt(e),n.previousValue=t.multiple?String(e):e},U=(e=[],l)=>{if(!Y(l))return e.indexOf(l);const a=t.valueKey;let u=-1;return e.some((c,m)=>B(c,a)===B(l,a)?(u=m,!0):!1),u},r=e=>Y(e)?B(e,t.valueKey):e,Ve=()=>{C()},be=()=>{n.selectionWidth=w.value.getBoundingClientRect().width},lt=()=>{n.collapseItemWidth=F.value.getBoundingClientRect().width},j=()=>{var e,l;(l=(e=_.value)==null?void 0:e.updatePopper)==null||l.call(e)},xe=()=>{var e,l;(l=(e=k.value)==null?void 0:e.updatePopper)==null||l.call(e)},Oe=e=>{if(t.multiple){let l=t.modelValue.slice();const a=U(l,f(e));a>-1?(l=[...l.slice(0,a),...l.slice(a+1)],n.cachedOptions.splice(a,1),A(e)):(t.multipleLimit<=0||l.length<t.multipleLimit)&&(l=[...l,f(e)],n.cachedOptions.push(e),ve(e)),y(l),e.created&&$(""),t.filterable&&!t.reserveKeyword&&(n.inputValue="")}else n.selectedLabel=V(e),y(f(e)),o.value=!1,ve(e),e.created||G();D()},nt=(e,l)=>{let a=t.modelValue.slice();const u=U(a,f(l));u>-1&&!O.value&&(a=[...t.modelValue.slice(0,u),...t.modelValue.slice(u+1)],n.cachedOptions.splice(u,1),y(a),h("remove-tag",f(l)),A(l)),e.stopPropagation(),D()},D=()=>{var e;(e=b.value)==null||e.focus()},at=()=>{var e;if(o.value){o.value=!1,p(()=>{var l;return(l=b.value)==null?void 0:l.blur()});return}(e=b.value)==null||e.blur()},ut=()=>{n.inputValue.length>0?n.inputValue="":o.value=!1},it=e=>Ht(e,l=>!n.cachedOptions.some(a=>f(a)===l&&R(a))),ot=e=>{if(t.multiple&&e.code!==Rt.delete&&n.inputValue.length===0){e.preventDefault();const l=t.modelValue.slice(),a=it(l);if(a<0)return;const u=l[a];l.splice(a,1);const c=n.cachedOptions[a];n.cachedOptions.splice(a,1),A(c),y(l),h("remove-tag",u)}},st=()=>{let e;T(t.modelValue)?e=[]:e=Se.value,t.multiple?n.cachedOptions=[]:n.selectedLabel="",o.value=!1,y(e),h("clear"),G(),D()},Ie=(e,l=void 0)=>{const a=s.value;if(!["forward","backward"].includes(e)||O.value||a.length<=0||ke.value||ne.value)return;if(!o.value)return Q();l===void 0&&(l=n.hoveringIndex);let u=-1;e==="forward"?(u=l+1,u>=a.length&&(u=0)):e==="backward"&&(u=l-1,(u<0||u>=a.length)&&(u=a.length-1));const c=a[u];if(R(c)||c.type==="Group")return Ie(e,u);n.hoveringIndex=u,q(u)},ct=()=>{if(o.value)~n.hoveringIndex&&s.value[n.hoveringIndex]&&Oe(s.value[n.hoveringIndex]);else return Q()},rt=e=>{n.hoveringIndex=e??-1},dt=()=>{t.multiple?n.hoveringIndex=s.value.findIndex(e=>t.modelValue.some(l=>r(l)===r(e))):n.hoveringIndex=s.value.findIndex(e=>r(e)===r(t.modelValue))},pe=e=>{if(n.inputValue=e.target.value,t.remote)ge();else return he()},ft=e=>{if(o.value=!1,ue.value){const l=new FocusEvent("focus",e);Ne(l)}},mt=()=>(n.isBeforeHide=!1,p(()=>{~Je.value&&q(n.hoveringIndex)})),q=e=>{x.value.scrollToItem(e)},vt=(e,l)=>{const a=r(e);if(de.value.has(a)){const{option:u}=de.value.get(a);return u}if(l&&l.length){const u=l.find(c=>r(f(c))===a);if(u)return u}return{[ee.value.value]:e,[ee.value.label]:e}},J=(e=!1)=>{if(t.multiple)if(t.modelValue.length>0){const l=n.cachedOptions.slice();n.cachedOptions.length=0,n.previousValue=t.modelValue.toString();for(const a of t.modelValue){const u=vt(a,l);n.cachedOptions.push(u)}}else n.cachedOptions=[],n.previousValue=void 0;else if(L.value){n.previousValue=t.modelValue;const l=s.value,a=l.findIndex(u=>r(f(u))===r(t.modelValue));~a?n.selectedLabel=V(l[a]):(!n.selectedLabel||e)&&(n.selectedLabel=r(t.modelValue))}else n.selectedLabel="",n.previousValue=void 0;G(),C()};return E(()=>t.fitInputWidth,()=>{C()}),E(o,e=>{e?(t.persistent||C(),$("")):(n.inputValue="",n.previousQuery=null,n.isBeforeHide=!0,me("")),h("visible-change",e)}),E(()=>t.modelValue,(e,l)=>{var a;(!e||T(e)&&e.length===0||t.multiple&&!Z(e.toString(),n.previousValue)||!t.multiple&&r(e)!==r(n.previousValue))&&J(!0),!Z(e,l)&&t.validateEvent&&((a=g==null?void 0:g.validate)==null||a.call(g,"change").catch(c=>Wt()))},{deep:!0}),E(()=>t.options,()=>{const e=b.value;(!e||e&&document.activeElement!==e)&&J()},{deep:!0,flush:"post"}),E(()=>s.value,()=>(C(),x.value&&p(x.value.resetScrollTop))),ye(()=>{n.isBeforeHide||re()}),ye(()=>{const{valueKey:e,options:l}=t,a=new Map;for(const u of l){const c=f(u);let m=c;if(Y(m)&&(m=B(c,e)),a.get(m))break;a.set(m,!0)}}),Pt(()=>{J()}),I(K,Ve),I(w,be),I(x,j),I(ae,j),I(le,xe),I(F,lt),{inputId:Ee,collapseTagSize:ze,currentPlaceholder:je,expanded:o,emptyText:se,popupHeight:He,debounce:oe,allOptions:v,filteredOptions:s,iconComponent:ie,iconReverse:Pe,tagStyle:Qe,collapseTagStyle:$e,popperSize:W,dropdownMenuVisible:Xe,hasModelValue:L,shouldShowPlaceholder:Ue,selectDisabled:O,selectSize:fe,needStatusIcon:De,showClearBtn:Be,states:n,isFocused:ue,nsSelect:P,nsInput:Te,inputRef:b,menuRef:x,tagMenuRef:le,tooltipRef:_,tagTooltipRef:k,selectRef:K,wrapperRef:ae,selectionRef:w,prefixRef:Re,suffixRef:We,collapseItemRef:F,popperRef:qe,validateState:z,validateIcon:Ke,showTagList:Ye,collapseTagList:Ze,debouncedOnInputChange:ge,deleteTag:nt,getLabel:V,getValue:f,getDisabled:R,getValueKey:r,handleClear:st,handleClickOutside:ft,handleDel:ot,handleEsc:ut,focus:D,blur:at,handleMenuEnter:mt,handleResize:Ve,resetSelectionWidth:be,updateTooltip:j,updateTagTooltip:xe,updateOptions:re,toggleMenu:Q,scrollTo:q,onInput:pe,onKeyboardNavigate:Ie,onKeyboardSelect:ct,onSelect:Oe,onHover:rt,handleCompositionStart:_e,handleCompositionEnd:Fe,handleCompositionUpdate:Le}};export{dl as u};
