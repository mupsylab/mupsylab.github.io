import{t as i}from"./vendor-0rdd-Cq9Fpw4b.js";import{i as u}from"./vendor-7avT-DhdrFwTb.js";import{i as f}from"./vendor-16Vo-CHIgUVhi.js";const l="ElUpload";class c extends Error{constructor(e,r,a,o){super(e),this.name="UploadAjaxError",this.status=r,this.method=a,this.url=o}}function d(t,e,r){let a;return r.response?a=`${r.response.error||r.response}`:r.responseText?a=`${r.responseText}`:a=`fail to ${e.method} ${t} ${r.status}`,new c(a,r.status,e.method,t)}function p(t){const e=t.responseText||t.response;if(!e)return e;try{return JSON.parse(e)}catch{return e}}const g=t=>{typeof XMLHttpRequest>"u"&&i(l,"XMLHttpRequest is undefined");const e=new XMLHttpRequest,r=t.action;e.upload&&e.upload.addEventListener("progress",n=>{const s=n;s.percent=n.total>0?n.loaded/n.total*100:0,t.onProgress(s)});const a=new FormData;if(t.data)for(const[n,s]of Object.entries(t.data))u(s)&&s.length?a.append(n,...s):a.append(n,s);a.append(t.filename,t.file,t.file.name),e.addEventListener("error",()=>{t.onError(d(r,t,e))}),e.addEventListener("load",()=>{if(e.status<200||e.status>=300)return t.onError(d(r,t,e));t.onSuccess(p(e))}),e.open(t.method,r,!0),t.withCredentials&&"withCredentials"in e&&(e.withCredentials=!0);const o=t.headers||{};if(o instanceof Headers)o.forEach((n,s)=>e.setRequestHeader(s,n));else for(const[n,s]of Object.entries(o))f(s)||e.setRequestHeader(n,String(s));return e.send(a),e};export{g as a};
