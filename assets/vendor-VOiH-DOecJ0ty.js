import{u as Y}from"./vendor-5WKb-KWd2YoVw.js";import{E as Z}from"./vendor-AQSj-DFJim-ok.js";import{F as ee}from"./vendor-Fq1d-qefZ2EtI.js";import{M as te}from"./vendor-4L6w-DvtyXhtN.js";import{E as ne}from"./vendor-SrRb-R2zcUmm7.js";import{S as le}from"./vendor-o11s-D5Plf2IH.js";import{u as oe}from"./vendor-N4yc-B2t-Qsd8.js";import{C as ae}from"./vendor-UDEi-Bp1F1IF-.js";import{b as ue,d as L}from"./vendor-BvSU-CYRVtLwv.js";import{m as se}from"./vendor-FQCA-Bp3YSIOJ.js";import{i as ie}from"./vendor-9yxy-Cbwm2u4R.js";import{u as D}from"./vendor-unoq-CFxLHdLI.js";import{f as re}from"./vendor-ShXQ-Bzrtgmud.js";import{c as x,i as ce,j as de}from"./vendor-7avT-DhdrFwTb.js";import{i as $}from"./vendor-16Vo-CHIgUVhi.js";import{d as me,g as fe,c as ve,w as k,m as pe,p as j,e as he,n as M,y as ge,t as Me}from"./vendor-RE7Z-DOm9JKld.js";import{r as v,a as be}from"./vendor-eqDO-Ti6p_k8X.js";const ye=ue({mode:{type:String,values:["horizontal","vertical"],default:"vertical"},defaultActive:{type:String,default:""},defaultOpeneds:{type:L(Array),default:()=>se([])},uniqueOpened:Boolean,router:Boolean,menuTrigger:{type:String,values:["hover","click"],default:"hover"},collapse:Boolean,backgroundColor:String,textColor:String,activeTextColor:String,closeOnClickOutside:Boolean,collapseTransition:{type:Boolean,default:!0},ellipsis:{type:Boolean,default:!0},popperOffset:{type:Number,default:6},ellipsisIcon:{type:ie,default:()=>ee},popperEffect:{type:L(String),default:"dark"},popperClass:String,showTimeout:{type:Number,default:300},hideTimeout:{type:Number,default:300},persistent:{type:Boolean,default:!0}}),E=t=>ce(t)&&t.every(u=>x(u)),Se={close:(t,u)=>x(t)&&E(u),open:(t,u)=>x(t)&&E(u),select:(t,u,b,y)=>x(t)&&E(u)&&de(b)&&(y===void 0||y instanceof Promise)};var De=me({name:"ElMenu",props:ye,emits:Se,setup(t,{emit:u,slots:b,expose:y}){const C=fe(),N=C.appContext.config.globalProperties.$router,c=v(),S=D("menu"),z=D("sub-menu"),d=v(-1),s=v(t.defaultOpeneds&&!t.collapse?t.defaultOpeneds.slice(0):[]),i=v(t.defaultActive),m=v({}),p=v({}),q=ve(()=>t.mode==="horizontal"||t.mode==="vertical"&&t.collapse),F=()=>{const e=i.value&&m.value[i.value];if(!e||t.mode==="horizontal"||t.collapse)return;e.indexPath.forEach(l=>{const o=p.value[l];o&&I(l,o.indexPath)})},I=(e,n)=>{s.value.includes(e)||(t.uniqueOpened&&(s.value=s.value.filter(l=>n.includes(l))),s.value.push(e),u("open",e,n))},w=e=>{const n=s.value.indexOf(e);n!==-1&&s.value.splice(n,1)},A=(e,n)=>{w(e),u("close",e,n)},V=({index:e,indexPath:n})=>{s.value.includes(e)?A(e,n):I(e,n)},G=e=>{(t.mode==="horizontal"||t.collapse)&&(s.value=[]);const{index:n,indexPath:l}=e;if(!($(n)||$(l)))if(t.router&&N){const o=e.route||n,a=N.push(o).then(f=>(f||(i.value=n),f));u("select",n,l,{index:n,indexPath:l,route:o},a)}else i.value=n,u("select",n,l,{index:n,indexPath:l})},H=e=>{var n;const l=m.value,o=l[e]||i.value&&l[i.value]||l[t.defaultActive];i.value=(n=o==null?void 0:o.index)!=null?n:e},J=e=>{const n=getComputedStyle(e),l=Number.parseInt(n.marginLeft,10),o=Number.parseInt(n.marginRight,10);return e.offsetWidth+l+o||0},B=()=>{var e,n;if(!c.value)return-1;const l=Array.from((n=(e=c.value)==null?void 0:e.childNodes)!=null?n:[]).filter(g=>g.nodeName!=="#text"||g.nodeValue),o=64,a=getComputedStyle(c.value),f=Number.parseInt(a.paddingLeft,10),r=Number.parseInt(a.paddingRight,10),P=c.value.clientWidth-f-r;let h=0,T=0;return l.forEach((g,X)=>{g.nodeName!=="#comment"&&(h+=J(g),h<=P-o&&(T=X+1))}),T===l.length?-1:T},K=e=>p.value[e].indexPath,Q=(e,n=33.34)=>{let l;return()=>{l&&clearTimeout(l),l=setTimeout(()=>{e()},n)}};let R=!0;const W=()=>{if(d.value===B())return;const e=()=>{d.value=-1,Me(()=>{d.value=B()})};R?e():Q(e)(),R=!1};k(()=>t.defaultActive,e=>{m.value[e]||(i.value=""),H(e)}),k(()=>t.collapse,e=>{e&&(s.value=[])}),k(m.value,F);let O;pe(()=>{t.mode==="horizontal"&&t.ellipsis?O=Y(c,W).stop:O==null||O()});const _=v(!1);{const e=a=>{p.value[a.index]=a},n=a=>{delete p.value[a.index]};j("rootMenu",be({props:t,openedMenus:s,items:m,subMenus:p,activeIndex:i,isMenuPopup:q,addMenuItem:a=>{m.value[a.index]=a},removeMenuItem:a=>{delete m.value[a.index]},addSubMenu:e,removeSubMenu:n,openMenu:I,closeMenu:A,handleMenuItemClick:G,handleSubMenuClick:V})),j(`subMenu:${C.uid}`,{addSubMenu:e,removeSubMenu:n,mouseInChild:_,level:0})}he(()=>{t.mode==="horizontal"&&new te(C.vnode.el,S.namespace.value)}),y({open:n=>{const{indexPath:l}=p.value[n];l.forEach(o=>I(o,l))},close:w,handleResize:W});const U=oe(t,0);return()=>{var e,n;let l=(n=(e=b.default)==null?void 0:e.call(b))!=null?n:[];const o=[];if(t.mode==="horizontal"&&c.value){const r=re(l),P=d.value===-1?r:r.slice(0,d.value),h=d.value===-1?[]:r.slice(d.value);h!=null&&h.length&&t.ellipsis&&(l=P,o.push(M(le,{index:"sub-menu-more",class:z.e("hide-arrow"),popperOffset:t.popperOffset},{title:()=>M(Z,{class:z.e("icon-more")},{default:()=>M(t.ellipsisIcon)}),default:()=>h})))}const a=t.closeOnClickOutside?[[ae,()=>{s.value.length&&(_.value||(s.value.forEach(r=>u("close",r,K(r))),s.value=[]))}]]:[],f=ge(M("ul",{key:String(t.collapse),role:"menubar",ref:c,style:U.value,class:{[S.b()]:!0,[S.m(t.mode)]:!0,[S.m("collapse")]:t.collapse}},[...l,...o]),a);return t.collapseTransition&&t.mode==="vertical"?M(ne,()=>f):f}}});export{De as M};
