import{c as u}from"./vendor-W2mj-CCBXsyCN.js";import{f as p,a as b}from"./vendor-UUu6-BeUS1t8s.js";import{d as f,i as m}from"./vendor-7avT-DhdrFwTb.js";let k=0;const y=o=>{const t=[o];let{parent:e}=o;for(;e;)t.unshift(e),e=e.parent;return t};class d{constructor(t,e,i,s=!1){this.data=t,this.config=e,this.parent=i,this.root=s,this.uid=k++,this.checked=!1,this.indeterminate=!1,this.loading=!1;const{value:h,label:a,children:n}=e,c=t[n],r=y(this);this.level=s?0:i?i.level+1:1,this.value=t[h],this.label=t[a],this.pathNodes=r,this.pathValues=r.map(l=>l.value),this.pathLabels=r.map(l=>l.label),this.childrenData=c,this.children=(c||[]).map(l=>new d(l,e,this)),this.loaded=!e.lazy||this.isLeaf||!p(c)}get isDisabled(){const{data:t,parent:e,config:i}=this,{disabled:s,checkStrictly:h}=i;return(f(s)?s(t,this):!!t[s])||!h&&(e==null?void 0:e.isDisabled)}get isLeaf(){const{data:t,config:e,childrenData:i,loaded:s}=this,{lazy:h,leaf:a}=e,n=f(a)?a(t,this):t[a];return b(n)?h&&!s?!1:!(m(i)&&i.length):!!n}get valueByOption(){return this.config.emitPath?this.pathValues:this.value}appendChild(t){const{childrenData:e,children:i}=this,s=new d(t,this.config,this);return m(e)?e.push(t):this.childrenData=[t],i.push(s),s}calcText(t,e){const i=t?this.pathLabels.join(e):this.label;return this.text=i,i}broadcast(t,...e){const i=`onParent${u(t)}`;this.children.forEach(s=>{s&&(s.broadcast(t,...e),s[i]&&s[i](...e))})}emit(t,...e){const{parent:i}=this,s=`onChild${u(t)}`;i&&(i[s]&&i[s](...e),i.emit(t,...e))}onParentCheck(t){this.isDisabled||this.setCheckState(t)}onChildCheck(){const{children:t}=this,e=t.filter(s=>!s.isDisabled),i=e.length?e.every(s=>s.checked):!1;this.setCheckState(i)}setCheckState(t){const e=this.children.length,i=this.children.reduce((s,h)=>{const a=h.checked?1:h.indeterminate?.5:0;return s+a},0);this.checked=this.loaded&&this.children.filter(s=>!s.isDisabled).every(s=>s.loaded&&s.checked)&&t,this.indeterminate=this.loaded&&i!==e&&i>0}doCheck(t){if(this.checked===t)return;const{checkStrictly:e,multiple:i}=this.config;e||!i?this.checked=t:(this.broadcast("check",t),this.setCheckState(t),this.emit("check"))}}export{d as N};
