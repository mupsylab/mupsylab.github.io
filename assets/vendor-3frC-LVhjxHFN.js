import{p as g}from"./vendor-8jHm-DXstvPfe.js";import{h as v,c as p}from"./vendor-7avT-DhdrFwTb.js";import{i as n}from"./vendor-UUu6-BeUS1t8s.js";import{i as x}from"./vendor-X8wK-D6OXYL3N.js";import{r as a,i as w}from"./vendor-eqDO-Ti6p_k8X.js";import{i as m}from"./vendor-k87t-DYFOtHqs.js";import{t as y}from"./vendor-RE7Z-DOm9JKld.js";class Y{constructor(t){this.observers=[],this.table=null,this.store=null,this.columns=[],this.fit=!0,this.showHeader=!0,this.height=a(null),this.scrollX=a(!1),this.scrollY=a(!1),this.bodyWidth=a(null),this.fixedWidth=a(null),this.rightFixedWidth=a(null),this.gutterWidth=0;for(const e in t)v(t,e)&&(w(this[e])?this[e].value=t[e]:this[e]=t[e]);if(!this.table)throw new Error("Table is required for Table Layout");if(!this.store)throw new Error("Store is required for Table Layout")}updateScrollY(){const t=this.height.value;if(x(t))return!1;const e=this.table.refs.scrollBarRef;if(this.table.vnode.el&&(e!=null&&e.wrapRef)){let s=!0;const h=this.scrollY.value;return s=e.wrapRef.scrollHeight>e.wrapRef.clientHeight,this.scrollY.value=s,h!==s}return!1}setHeight(t,e="height"){if(!m)return;const s=this.table.vnode.el;if(t=g(t),this.height.value=Number(t),!s&&(t||t===0))return y(()=>this.setHeight(t,e));n(t)?(s.style[e]=`${t}px`,this.updateElsHeight()):p(t)&&(s.style[e]=t,this.updateElsHeight())}setMaxHeight(t){this.setHeight(t,"max-height")}getFlattenColumns(){const t=[];return this.table.store.states.columns.value.forEach(s=>{s.isColumnGroup?t.push.apply(t,s.columns):t.push(s)}),t}updateElsHeight(){this.updateScrollY(),this.notifyObservers("scrollable")}headerDisplayNone(t){if(!t)return!0;let e=t;for(;e.tagName!=="DIV";){if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}updateColumnsWidth(){if(!m)return;const t=this.fit,e=this.table.vnode.el.clientWidth;let s=0;const h=this.getFlattenColumns(),r=h.filter(i=>!n(i.width));if(h.forEach(i=>{n(i.width)&&i.realWidth&&(i.realWidth=null)}),r.length>0&&t){if(h.forEach(i=>{s+=Number(i.width||i.minWidth||80)}),s<=e){this.scrollX.value=!1;const i=e-s;if(r.length===1)r[0].realWidth=Number(r[0].minWidth||80)+i;else{const l=r.reduce((o,d)=>o+Number(d.minWidth||80),0),W=i/l;let b=0;r.forEach((o,d)=>{if(d===0)return;const c=Math.floor(Number(o.minWidth||80)*W);b+=c,o.realWidth=Number(o.minWidth||80)+c}),r[0].realWidth=Number(r[0].minWidth||80)+i-b}}else this.scrollX.value=!0,r.forEach(i=>{i.realWidth=Number(i.minWidth)});this.bodyWidth.value=Math.max(s,e),this.table.state.resizeState.value.width=this.bodyWidth.value}else h.forEach(i=>{!i.width&&!i.minWidth?i.realWidth=80:i.realWidth=Number(i.width||i.minWidth),s+=i.realWidth}),this.scrollX.value=s>e,this.bodyWidth.value=s;const f=this.store.states.fixedColumns.value;if(f.length>0){let i=0;f.forEach(l=>{i+=Number(l.realWidth||l.width)}),this.fixedWidth.value=i}const u=this.store.states.rightFixedColumns.value;if(u.length>0){let i=0;u.forEach(l=>{i+=Number(l.realWidth||l.width)}),this.rightFixedWidth.value=i}this.notifyObservers("columns")}addObserver(t){this.observers.push(t)}removeObserver(t){const e=this.observers.indexOf(t);e!==-1&&this.observers.splice(e,1)}notifyObservers(t){this.observers.forEach(s=>{var h,r;switch(t){case"columns":(h=s.state)==null||h.onColumnsChange(this);break;case"scrollable":(r=s.state)==null||r.onScrollableChange(this);break;default:throw new Error(`Table Layout don't have event ${t}.`)}})}}export{Y as T};
