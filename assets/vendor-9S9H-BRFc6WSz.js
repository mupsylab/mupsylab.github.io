import{a as y,w as q}from"./vendor-8F4M-BzORa8vA.js";import{o as ve}from"./vendor-5WKb-KWd2YoVw.js";import{l as me}from"./vendor-Fq1d-qefZ2EtI.js";import{E as ge}from"./vendor-pkf1-gHYU-KiM.js";import{E as he}from"./vendor-MxHc-DHRJLLZd.js";import{E as be}from"./vendor-NFpn-BrHihosC.js";import{E as ye}from"./vendor-AQSj-DFJim-ok.js";import{a as Ee,b as $e}from"./vendor-9Plx-BxZWDP4i.js";import{_ as we}from"./vendor-pM4a-CqGSI99y.js";import{u as Ae}from"./vendor-g2q2-CIPiop1j.js";import{a as Ce}from"./vendor-hmuK-B6xHqdWm.js";import{u as Ie}from"./vendor-unoq-CFxLHdLI.js";import{u as Se}from"./vendor-9Byw-aJtbE-z4.js";import{a as G,n as w,t as ke,i as V}from"./vendor-7avT-DhdrFwTb.js";import{I as j,U as _,C as Te}from"./vendor-lLeK-BB_Ol6Sd.js";import{t as Ne}from"./vendor-0rdd-Cq9Fpw4b.js";import{d as De}from"./vendor-9Eji-ZqQOO7NL.js";import{d as Q,R as Ve,c as A,j as _e,e as Fe,f as Re,o as C,h as p,b as J,z as I,H as Be,A as Ke,r as g,a as F,F as Pe,D as Me,E as He}from"./vendor-RE7Z-DOm9JKld.js";import{r as c,u as a}from"./vendor-eqDO-Ti6p_k8X.js";const X="ElAutocomplete",Le=Q({name:X,inheritAttrs:!1}),Oe=Q({...Le,props:$e,emits:Ee,setup(Y,{expose:Z,emit:n}){const o=Y,x=Ae(),ee=Ve(),R=Ce(),u=Ie("autocomplete"),l=c(),B=c(),E=c(),K=c();let P=!1,S=!1;const i=c([]),s=c(-1),M=c(""),f=c(!1),$=c(!1),v=c(!1),h=Se(),ae=A(()=>ee.style),d=A(()=>(i.value.length>0||v.value)&&f.value),H=A(()=>!o.hideLoading&&v.value),te=A(()=>l.value?Array.from(l.value.$el.querySelectorAll("input")):[]),se=()=>{d.value&&(M.value=`${l.value.$el.offsetWidth}px`)},oe=()=>{s.value=-1},L=async e=>{if($.value)return;const t=r=>{v.value=!1,!$.value&&(V(r)?(i.value=r,s.value=o.highlightFirstItem?0:-1):Ne(X,"autocomplete suggestions must be an array"))};if(v.value=!0,V(o.fetchSuggestions))t(o.fetchSuggestions);else{const r=await o.fetchSuggestions(e,t);V(r)&&t(r)}},O=De(L,o.debounce),le=e=>{const t=!!e;if(n(j,e),n(_,e),$.value=!1,f.value||(f.value=t),!o.triggerOnFocus&&!e){$.value=!0,i.value=[];return}O(e)},re=e=>{var t;R.value||(((t=e.target)==null?void 0:t.tagName)!=="INPUT"||te.value.includes(document.activeElement))&&(f.value=!0)},ne=e=>{n(Te,e)},ie=e=>{S?S=!1:(f.value=!0,n("focus",e),o.triggerOnFocus&&!P&&O(String(o.modelValue)))},ue=e=>{setTimeout(()=>{var t;if((t=E.value)!=null&&t.isFocusInsideContent()){S=!0;return}f.value&&b(),n("blur",e)})},ce=()=>{f.value=!1,n(_,""),n("clear")},U=async()=>{d.value&&s.value>=0&&s.value<i.value.length?k(i.value[s.value]):o.selectWhenUnmatched&&(n("select",{value:o.modelValue}),i.value=[],s.value=-1)},fe=e=>{d.value&&(e.preventDefault(),e.stopPropagation(),b())},b=()=>{f.value=!1},pe=()=>{var e;(e=l.value)==null||e.focus()},de=()=>{var e;(e=l.value)==null||e.blur()},k=async e=>{n(j,e[o.valueKey]),n(_,e[o.valueKey]),n("select",e),i.value=[],s.value=-1},T=e=>{if(!d.value||v.value)return;if(e<0){s.value=-1;return}e>=i.value.length&&(e=i.value.length-1);const t=B.value.querySelector(`.${u.be("suggestion","wrap")}`),m=t.querySelectorAll(`.${u.be("suggestion","list")} li`)[e],N=t.scrollTop,{offsetTop:z,scrollHeight:D}=m;z+D>N+t.clientHeight&&(t.scrollTop+=D),z<N&&(t.scrollTop-=D),s.value=e,l.value.ref.setAttribute("aria-activedescendant",`${h.value}-item-${s.value}`)},W=ve(K,()=>{var e;(e=E.value)!=null&&e.isFocusInsideContent()||d.value&&b()});return _e(()=>{W==null||W()}),Fe(()=>{l.value.ref.setAttribute("role","textbox"),l.value.ref.setAttribute("aria-autocomplete","list"),l.value.ref.setAttribute("aria-controls","id"),l.value.ref.setAttribute("aria-activedescendant",`${h.value}-item-${s.value}`),P=l.value.ref.hasAttribute("readonly")}),Z({highlightedIndex:s,activated:f,loading:v,inputRef:l,popperRef:E,suggestions:i,handleSelect:k,handleKeyEnter:U,focus:pe,blur:de,close:b,highlight:T,getData:L}),(e,t)=>(C(),Re(a(be),{ref_key:"popperRef",ref:E,visible:a(d),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[a(u).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${a(u).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:se,onHide:oe},{content:p(()=>[J("div",{ref_key:"regionRef",ref:B,class:w([a(u).b("suggestion"),a(u).is("loading",a(H))]),style:G({[e.fitInputWidth?"width":"minWidth"]:M.value,outline:"none"}),role:"region"},[I(a(he),{id:a(h),tag:"ul","wrap-class":a(u).be("suggestion","wrap"),"view-class":a(u).be("suggestion","list"),role:"listbox"},{default:p(()=>[a(H)?(C(),F("li",{key:0},[g(e.$slots,"loading",{},()=>[I(a(ye),{class:w(a(u).is("loading"))},{default:p(()=>[I(a(me))]),_:1},8,["class"])])])):(C(!0),F(Pe,{key:1},Me(i.value,(r,m)=>(C(),F("li",{id:`${a(h)}-item-${m}`,key:m,class:w({highlighted:s.value===m}),role:"option","aria-selected":s.value===m,onClick:N=>k(r)},[g(e.$slots,"default",{item:r},()=>[He(ke(r[e.valueKey]),1)])],10,["id","aria-selected","onClick"]))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:p(()=>[J("div",{ref_key:"listboxRef",ref:K,class:w([a(u).b(),e.$attrs.class]),style:G(a(ae)),role:"combobox","aria-haspopup":"listbox","aria-expanded":a(d),"aria-owns":a(h)},[I(a(ge),Be({ref_key:"inputRef",ref:l},a(x),{clearable:e.clearable,disabled:a(R),name:e.name,"model-value":e.modelValue,"aria-label":e.ariaLabel,onInput:le,onChange:ne,onFocus:ie,onBlur:ue,onClear:ce,onKeydown:[y(q(r=>T(s.value-1),["prevent"]),["up"]),y(q(r=>T(s.value+1),["prevent"]),["down"]),y(U,["enter"]),y(b,["tab"]),y(fe,["esc"])],onMousedown:re}),Ke({_:2},[e.$slots.prepend?{name:"prepend",fn:p(()=>[g(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:p(()=>[g(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:p(()=>[g(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:p(()=>[g(e.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","aria-label","onKeydown"])],14,["aria-expanded","aria-owns"])]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var na=we(Oe,[["__file","autocomplete.vue"]]);export{na as A};
