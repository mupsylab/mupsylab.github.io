import{w as ne}from"./vendor-8F4M-BzORa8vA.js";import{E as se}from"./vendor-pkf1-gHYU-KiM.js";import{E as re}from"./vendor-NFpn-BrHihosC.js";import{m as le,a as ie}from"./vendor-c73U-DawYpZ2D.js";import{g as pe,a as ue}from"./vendor-FtA0-qmVqPOrw.js";import{E as ce}from"./vendor-zznN-BEO7OuBL.js";import{_ as de}from"./vendor-pM4a-CqGSI99y.js";import{a as fe}from"./vendor-KDNv-DmbVfGd7.js";import{u as ve}from"./vendor-unoq-CFxLHdLI.js";import{a as me}from"./vendor-hmuK-B6xHqdWm.js";import{u as he}from"./vendor-9Byw-aJtbE-z4.js";import{u as be}from"./vendor-GuIu-Dc0c8fP9.js";import{E as p}from"./vendor-bP7i-BUADUvnR.js";import{e as A,a as we,n as Ee,d as ge}from"./vendor-7avT-DhdrFwTb.js";import{U as F}from"./vendor-lLeK-BB_Ol6Sd.js";import{p as _e}from"./vendor-4rcf-DOLgXHSV.js";import{d as H,c as f,a as ke,o as Ie,z as R,A as T,D as N,h as y,r as W,B as z,H as L,b as Ce,t as V}from"./vendor-RE7Z-DOm9JKld.js";import{r as v,u as o}from"./vendor-eqDO-Ti6p_k8X.js";const ye=H({name:"ElMention",inheritAttrs:!1}),Pe=H({...ye,props:ie,emits:le,setup(K,{expose:U,emit:m}){const n=K,j=f(()=>_e(n,Object.keys(fe))),P=ve("mention"),w=me(),$=he(),u=v(),E=v(),h=v(),l=v(!1),M=v(),s=v(),q=f(()=>n.showArrow?n.placement:`${n.placement}-start`),G=f(()=>n.showArrow?["bottom","top"]:["bottom-start","top-start"]),S=f(()=>{const{filterOption:e,options:t}=n;return!s.value||!e?t:t.filter(a=>e(s.value.pattern,a))}),c=f(()=>l.value&&(!!S.value.length||n.loading)),J=f(()=>{var e;return`${$.value}-${(e=h.value)==null?void 0:e.hoveringIndex}`}),Q=e=>{m("update:modelValue",e),_()},X=e=>{var t,a,r,i;if(!(!("code"in e)||(t=u.value)!=null&&t.isComposing))switch(e.code){case p.left:case p.right:_();break;case p.up:case p.down:if(!l.value)return;e.preventDefault(),(a=h.value)==null||a.navigateOptions(e.code===p.up?"prev":"next");break;case p.enter:case p.numpadEnter:if(!l.value)return;e.preventDefault(),(r=h.value)!=null&&r.hoverOption?(i=h.value)==null||i.selectHoverOption():l.value=!1;break;case p.esc:if(!l.value)return;e.preventDefault(),l.value=!1;break;case p.backspace:if(n.whole&&s.value){const{splitIndex:d,selectionEnd:k,pattern:I,prefixIndex:b,prefix:oe}=s.value,C=g();if(!C)return;const O=C.value,ae=n.options.find(D=>D.value===I);if((ge(n.checkIsWhole)?n.checkIsWhole(I,oe):ae)&&d!==-1&&d+1===k){e.preventDefault();const D=O.slice(0,b)+O.slice(d+1);m(F,D);const B=b;V(()=>{C.selectionStart=B,C.selectionEnd=B,x()})}}}},{wrapperRef:Y}=be(u,{beforeFocus(){return w.value},afterFocus(){_()},beforeBlur(e){var t;return(t=E.value)==null?void 0:t.isFocusInsideContent(e)},afterBlur(){l.value=!1}}),Z=()=>{_()},ee=e=>{if(!s.value)return;const t=g();if(!t)return;const a=t.value,{split:r}=n,i=a.slice(s.value.end),d=i.startsWith(r),k=`${e.value}${d?"":r}`,I=a.slice(0,s.value.start)+k+i;m(F,I),m("select",e,s.value.prefix);const b=s.value.start+k.length+(d?1:0);V(()=>{t.selectionStart=b,t.selectionEnd=b,t.focus(),x()})},g=()=>{var e,t;return n.type==="textarea"?(e=u.value)==null?void 0:e.textarea:(t=u.value)==null?void 0:t.input},_=()=>{setTimeout(()=>{te(),x(),V(()=>{var e;return(e=E.value)==null?void 0:e.updatePopper()})},0)},te=()=>{const e=g();if(!e)return;const t=pe(e),a=e.getBoundingClientRect(),r=u.value.$el.getBoundingClientRect();M.value={position:"absolute",width:0,height:`${t.height}px`,left:`${t.left+a.left-r.left}px`,top:`${t.top+a.top-r.top}px`}},x=()=>{const e=g();if(document.activeElement!==e){l.value=!1;return}const{prefix:t,split:a}=n;if(s.value=ue(e,t,a),s.value&&s.value.splitIndex===-1){l.value=!0,m("search",s.value.pattern,s.value.prefix);return}l.value=!1};return U({input:u,tooltip:E,dropdownVisible:c}),(e,t)=>(Ie(),ke("div",{ref_key:"wrapperRef",ref:Y,class:Ee([o(P).b(),o(P).is("disabled",o(w))])},[R(o(se),L(L(o(j),e.$attrs),{ref_key:"elInputRef",ref:u,"model-value":e.modelValue,disabled:o(w),role:o(c)?"combobox":void 0,"aria-activedescendant":o(c)?o(J)||"":void 0,"aria-controls":o(c)?o($):void 0,"aria-expanded":o(c)||void 0,"aria-label":e.ariaLabel,"aria-autocomplete":o(c)?"none":void 0,"aria-haspopup":o(c)?"listbox":void 0,onInput:Q,onKeydown:X,onMousedown:Z}),T({_:2},[N(e.$slots,(a,r)=>({name:r,fn:y(i=>[W(e.$slots,r,A(z(i)))])}))]),1040,["model-value","disabled","role","aria-activedescendant","aria-controls","aria-expanded","aria-label","aria-autocomplete","aria-haspopup"]),R(o(re),{ref_key:"tooltipRef",ref:E,visible:o(c),"popper-class":[o(P).e("popper"),e.popperClass],"popper-options":e.popperOptions,placement:o(q),"fallback-placements":o(G),effect:"light",pure:"",offset:e.offset,"show-arrow":e.showArrow},{default:y(()=>[Ce("div",{style:we(M.value)},null,4)]),content:y(()=>{var a;return[R(ce,{ref_key:"dropdownRef",ref:h,options:o(S),disabled:o(w),loading:e.loading,"content-id":o($),"aria-label":e.ariaLabel,onSelect:ee,onClick:ne((a=u.value)==null?void 0:a.focus,["stop"])},T({_:2},[N(e.$slots,(r,i)=>({name:i,fn:y(d=>[W(e.$slots,i,A(z(d)))])}))]),1032,["options","disabled","loading","content-id","aria-label","onClick"])]}),_:3},8,["visible","popper-class","popper-options","placement","fallback-placements","offset","show-arrow"])],2))}});var je=de(Pe,[["__file","mention.vue"]]);export{je as M};
