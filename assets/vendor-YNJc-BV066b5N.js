import{m as x,N as y}from"./vendor-RODT-CrxIlgye.js";import{h as L,i as o,d as E,c as S}from"./vendor-7avT-DhdrFwTb.js";import{c as b,a as g}from"./vendor-UUu6-BeUS1t8s.js";import{a as w}from"./vendor-eqDO-Ti6p_k8X.js";const C=h=>{let e=!0,t=!0,i=!0;for(let s=0,a=h.length;s<a;s++){const r=h[s];(r.checked!==!0||r.indeterminate)&&(e=!1,r.disabled||(i=!1)),(r.checked!==!1||r.indeterminate)&&(t=!1)}return{all:e,none:t,allWithoutDisable:i,half:!e&&!t}},d=function(h){if(h.childNodes.length===0||h.loading)return;const{all:e,none:t,half:i}=C(h.childNodes);e?(h.checked=!0,h.indeterminate=!1):i?(h.checked=!1,h.indeterminate=!0):t&&(h.checked=!1,h.indeterminate=!1);const s=h.parent;!s||s.level===0||h.store.checkStrictly||d(s)},f=function(h,e){const t=h.store.props,i=h.data||{},s=t[e];if(E(s))return s(i,h);if(S(s))return i[s];if(g(s)){const a=i[e];return a===void 0?"":a}};let z=0;class c{constructor(e){this.id=z++,this.text=null,this.checked=!1,this.indeterminate=!1,this.data=null,this.expanded=!1,this.parent=null,this.visible=!0,this.isCurrent=!1,this.canFocus=!1;for(const t in e)L(e,t)&&(this[t]=e[t]);this.level=0,this.loaded=!1,this.childNodes=[],this.loading=!1,this.parent&&(this.level=this.parent.level+1)}initialize(){const e=this.store;if(!e)throw new Error("[Node]store is required!");e.registerNode(this);const t=e.props;if(t&&typeof t.isLeaf<"u"){const a=f(this,"isLeaf");b(a)&&(this.isLeafByUser=a)}if(e.lazy!==!0&&this.data?(this.setData(this.data),e.defaultExpandAll&&(this.expanded=!0,this.canFocus=!0)):this.level>0&&e.lazy&&e.defaultExpandAll&&!this.isLeafByUser&&this.expand(),o(this.data)||x(this,this.data),!this.data)return;const i=e.defaultExpandedKeys,s=e.key;s&&i&&i.includes(this.key)&&this.expand(null,e.autoExpandParent),s&&e.currentNodeKey!==void 0&&this.key===e.currentNodeKey&&(e.currentNode=this,e.currentNode.isCurrent=!0),e.lazy&&e._initDefaultCheckedNode(this),this.updateLeafState(),this.parent&&(this.level===1||this.parent.expanded===!0)&&(this.canFocus=!0)}setData(e){o(e)||x(this,e),this.data=e,this.childNodes=[];let t;this.level===0&&o(this.data)?t=this.data:t=f(this,"children")||[];for(let i=0,s=t.length;i<s;i++)this.insertChild({data:t[i]})}get label(){return f(this,"label")}get key(){const e=this.store.key;return this.data?this.data[e]:null}get disabled(){return f(this,"disabled")}get nextSibling(){const e=this.parent;if(e){const t=e.childNodes.indexOf(this);if(t>-1)return e.childNodes[t+1]}return null}get previousSibling(){const e=this.parent;if(e){const t=e.childNodes.indexOf(this);if(t>-1)return t>0?e.childNodes[t-1]:null}return null}contains(e,t=!0){return(this.childNodes||[]).some(i=>i===e||t&&i.contains(e))}remove(){const e=this.parent;e&&e.removeChild(this)}insertChild(e,t,i){if(!e)throw new Error("InsertChild error: child is required.");if(!(e instanceof c)){if(!i){const s=this.getChildren(!0);s.includes(e.data)||(g(t)||t<0?s.push(e.data):s.splice(t,0,e.data))}Object.assign(e,{parent:this,store:this.store}),e=w(new c(e)),e instanceof c&&e.initialize()}e.level=this.level+1,g(t)||t<0?this.childNodes.push(e):this.childNodes.splice(t,0,e),this.updateLeafState()}insertBefore(e,t){let i;t&&(i=this.childNodes.indexOf(t)),this.insertChild(e,i)}insertAfter(e,t){let i;t&&(i=this.childNodes.indexOf(t),i!==-1&&(i+=1)),this.insertChild(e,i)}removeChild(e){const t=this.getChildren()||[],i=t.indexOf(e.data);i>-1&&t.splice(i,1);const s=this.childNodes.indexOf(e);s>-1&&(this.store&&this.store.deregisterNode(e),e.parent=null,this.childNodes.splice(s,1)),this.updateLeafState()}removeChildByData(e){let t=null;for(let i=0;i<this.childNodes.length;i++)if(this.childNodes[i].data===e){t=this.childNodes[i];break}t&&this.removeChild(t)}expand(e,t){const i=()=>{if(t){let s=this.parent;for(;s.level>0;)s.expanded=!0,s=s.parent}this.expanded=!0,e&&e(),this.childNodes.forEach(s=>{s.canFocus=!0})};this.shouldLoadData()?this.loadData(s=>{o(s)&&(this.checked?this.setChecked(!0,!0):this.store.checkStrictly||d(this),i())}):i()}doCreateChildren(e,t={}){e.forEach(i=>{this.insertChild(Object.assign({data:i},t),void 0,!0)})}collapse(){this.expanded=!1,this.childNodes.forEach(e=>{e.canFocus=!1})}shouldLoadData(){return this.store.lazy===!0&&this.store.load&&!this.loaded}updateLeafState(){if(this.store.lazy===!0&&this.loaded!==!0&&typeof this.isLeafByUser<"u"){this.isLeaf=this.isLeafByUser;return}const e=this.childNodes;if(!this.store.lazy||this.store.lazy===!0&&this.loaded===!0){this.isLeaf=!e||e.length===0;return}this.isLeaf=!1}setChecked(e,t,i,s){if(this.indeterminate=e==="half",this.checked=e===!0,this.store.checkStrictly)return;if(!(this.shouldLoadData()&&!this.store.checkDescendants)){const{all:r,allWithoutDisable:n}=C(this.childNodes);!this.isLeaf&&!r&&n&&(this.checked=!1,e=!1);const u=()=>{if(t){const l=this.childNodes;for(let p=0,v=l.length;p<v;p++){const N=l[p];s=s||e!==!1;const D=N.disabled?N.checked:s;N.setChecked(D,t,!0,s)}const{half:m,all:k}=C(l);k||(this.checked=k,this.indeterminate=m)}};if(this.shouldLoadData()){this.loadData(()=>{u(),d(this)},{checked:e!==!1});return}else u()}const a=this.parent;!a||a.level===0||i||d(a)}getChildren(e=!1){if(this.level===0)return this.data;const t=this.data;if(!t)return null;const i=this.store.props;let s="children";return i&&(s=i.children||"children"),t[s]===void 0&&(t[s]=null),e&&!t[s]&&(t[s]=[]),t[s]}updateChildren(){const e=this.getChildren()||[],t=this.childNodes.map(a=>a.data),i={},s=[];e.forEach((a,r)=>{const n=a[y];!!n&&t.findIndex(l=>l[y]===n)>=0?i[n]={index:r,data:a}:s.push({index:r,data:a})}),this.store.lazy||t.forEach(a=>{i[a[y]]||this.removeChildByData(a)}),s.forEach(({index:a,data:r})=>{this.insertChild({data:r},a)}),this.updateLeafState()}loadData(e,t={}){if(this.store.lazy===!0&&this.store.load&&!this.loaded&&(!this.loading||Object.keys(t).length)){this.loading=!0;const i=a=>{this.childNodes=[],this.doCreateChildren(a,t),this.loaded=!0,this.loading=!1,this.updateLeafState(),e&&e.call(this,a)},s=()=>{this.loading=!1};this.store.load(this,i,s)}else e&&e.call(this)}eachNode(e){const t=[this];for(;t.length;){const i=t.shift();t.unshift(...i.childNodes),e(i)}}reInitChecked(){this.store.checkStrictly||d(this)}}export{c as N};
