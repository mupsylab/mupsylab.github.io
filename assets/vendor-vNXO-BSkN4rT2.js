import{f as D}from"./vendor-5WKb-KWd2YoVw.js";import{w as H}from"./vendor-Lz0z-DtdwUXGG.js";import{g as X,a as Y,r as j}from"./vendor-9Mks-DMcTqn3l.js";import{u as G,F as N}from"./vendor-rY0G-BRvIl2eW.js";import{_ as U}from"./vendor-pM4a-CqGSI99y.js";import{a as q,i as J}from"./vendor-7avT-DhdrFwTb.js";import{d as S,c as r,e as K,w as Q,j as V,a as Z,o as tt,r as et}from"./vendor-RE7Z-DOm9JKld.js";import{s as w,r as nt}from"./vendor-eqDO-Ti6p_k8X.js";const ot=S({name:"ElWatermark"}),at=S({...ot,props:H,setup(W){const n=W,M={position:"relative"},$=r(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.color)!=null?e:"rgba(0,0,0,.15)"}),h=r(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.fontSize)!=null?e:16}),z=r(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.fontWeight)!=null?e:"normal"}),A=r(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.fontStyle)!=null?e:"normal"}),_=r(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.fontFamily)!=null?e:"sans-serif"}),C=r(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.textAlign)!=null?e:"center"}),R=r(()=>{var t,e;return(e=(t=n.font)==null?void 0:t.textBaseline)!=null?e:"hanging"}),x=r(()=>n.gap[0]),b=r(()=>n.gap[1]),k=r(()=>x.value/2),y=r(()=>b.value/2),E=r(()=>{var t,e;return(e=(t=n.offset)==null?void 0:t[0])!=null?e:k.value}),F=r(()=>{var t,e;return(e=(t=n.offset)==null?void 0:t[1])!=null?e:y.value}),T=()=>{const t={zIndex:n.zIndex,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let e=E.value-k.value,o=F.value-y.value;return e>0&&(t.left=`${e}px`,t.width=`calc(100% - ${e}px)`,e=0),o>0&&(t.top=`${o}px`,t.height=`calc(100% - ${o}px)`,o=0),t.backgroundPosition=`${e}px ${o}px`,t},f=w(null),l=w(),d=nt(!1),B=()=>{l.value&&(l.value.remove(),l.value=void 0)},I=(t,e)=>{var o;f.value&&l.value&&(d.value=!0,l.value.setAttribute("style",Y({...T(),backgroundImage:`url('${t}')`,backgroundSize:`${Math.floor(e)}px`})),(o=f.value)==null||o.append(l.value),setTimeout(()=>{d.value=!1}))},P=t=>{let e=120,o=64;const v=n.image,u=n.content,m=n.width,p=n.height;if(!v&&t.measureText){t.font=`${Number(h.value)}px ${_.value}`;const c=J(u)?u:[u],i=c.map(a=>{const s=t.measureText(a);return[s.width,s.fontBoundingBoxAscent!==void 0?s.fontBoundingBoxAscent+s.fontBoundingBoxDescent:s.actualBoundingBoxAscent+s.actualBoundingBoxDescent]});e=Math.ceil(Math.max(...i.map(a=>a[0]))),o=Math.ceil(Math.max(...i.map(a=>a[1])))*c.length+(c.length-1)*N}return[m??e,p??o]},L=G(),g=()=>{const e=document.createElement("canvas").getContext("2d"),o=n.image,v=n.content,u=n.rotate;if(e){l.value||(l.value=document.createElement("div"));const m=X(),[p,c]=P(e),i=a=>{const[s,O]=L(a||"",u,m,p,c,{color:$.value,fontSize:h.value,fontStyle:A.value,fontWeight:z.value,fontFamily:_.value,textAlign:C.value,textBaseline:R.value},x.value,b.value);I(s,O)};if(o){const a=new Image;a.onload=()=>{i(a)},a.onerror=()=>{i(v)},a.crossOrigin="anonymous",a.referrerPolicy="no-referrer",a.src=o}else i(v)}};return K(()=>{g()}),Q(()=>n,()=>{g()},{deep:!0,flush:"post"}),V(()=>{B()}),D(f,t=>{d.value||t.forEach(e=>{j(e,l.value)&&(B(),g())})},{attributes:!0,subtree:!0,childList:!0}),(t,e)=>(tt(),Z("div",{ref_key:"containerRef",ref:f,style:q([M])},[et(t.$slots,"default")],4))}});var pt=U(at,[["__file","watermark.vue"]]);export{pt as W};
